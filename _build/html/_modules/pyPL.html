

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>pyPL &mdash; pyPL 1.0 documentation</title>
    
    <link rel="stylesheet" href="../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="pyPL 1.0 documentation" href="../index.html" />
    <link rel="up" title="Module code" href="index.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../index.html">pyPL 1.0 documentation</a> &raquo;</li>
          <li><a href="index.html" accesskey="U">Module code</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <h1>Source code for pyPL</h1><div class="highlight"><pre>
<span class="c">#!/usr/bin/python</span>
<span class="sd">&quot;&quot;&quot; </span>
<span class="sd">   Program to control APT piezos and motors using a nicer interface than</span>
<span class="sd">   what was provided by APT (especially in the case of the piezos).</span>
<span class="sd">   </span>
<span class="sd">   Copyright 2010 Kasey Russell ( email: krussell _at_ post.harvard.edu )</span>
<span class="sd">   Distributed under the GNU General Public License</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">wx</span>
<span class="kn">from</span> <span class="nn">wx.lib.pubsub</span> <span class="kn">import</span> <span class="n">Publisher</span>

<span class="kn">import</span> <span class="nn">matplotlib</span>
<span class="k">if</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">get_backend</span><span class="p">()</span> <span class="o">!=</span> <span class="s">&#39;WXAgg&#39;</span><span class="p">:</span>
    <span class="c"># this is actually just to check if it&#39;s loaded. if it already was loaded</span>
    <span class="c"># and set to a different backend, then we couldn&#39;t change it anyway.</span>
    <span class="n">matplotlib</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s">&#39;WXAgg&#39;</span><span class="p">)</span>

<span class="kn">import</span> <span class="nn">pylab</span>

<span class="kn">from</span> <span class="nn">APTSystemControl</span> <span class="kn">import</span> <span class="n">APTSystem</span>
<span class="kn">from</span> <span class="nn">APTPiezoControl</span> <span class="kn">import</span> <span class="n">APTPiezo</span>
<span class="kn">from</span> <span class="nn">APTMotorControl</span> <span class="kn">import</span> <span class="n">APTMotor</span>

<span class="kn">import</span> <span class="nn">time</span>

<span class="kn">import</span> <span class="nn">PositionLogger</span>
<span class="kn">import</span> <span class="nn">MainWindowFrame_ThreePiezos</span> <span class="kn">as</span> <span class="nn">pyPiezo</span>
<span class="kn">import</span> <span class="nn">ImageNavigation</span>

<span class="kn">from</span> <span class="nn">Wobble</span> <span class="kn">import</span> <span class="n">wobble</span>

<span class="c"># make some menu item ID&#39;s:</span>
<span class="n">ID_File_Exit</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">NewId</span><span class="p">()</span>
<span class="n">ID_Window_Piezo</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">NewId</span><span class="p">()</span>
<span class="n">ID_Window_PositionLog</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">NewId</span><span class="p">()</span>
<span class="n">ID_Window_ImageNavigation</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">NewId</span><span class="p">()</span>
<span class="n">ID_Window_ManageMarkers</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">NewId</span><span class="p">()</span>
<span class="n">ID_Window_Raster</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">NewId</span><span class="p">()</span>
<span class="n">ID_Window_WinSpec</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">NewId</span><span class="p">()</span>
<span class="n">ID_Window_Wobble</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">NewId</span><span class="p">()</span>
<span class="n">ID_Joystick_Reinitialize</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">NewId</span><span class="p">()</span>
<span class="n">ID_PositionLog_Erase</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">NewId</span><span class="p">()</span>
<span class="n">ID_MarkerLog_Erase</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">NewId</span><span class="p">()</span>

<div class="viewcode-block" id="MainApp"><a class="viewcode-back" href="../pyPL.html#pyPL.MainApp">[docs]</a><span class="k">class</span> <span class="nc">MainApp</span><span class="p">(</span> <span class="n">wx</span><span class="o">.</span><span class="n">App</span> <span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; This is the main event loop for the pyPL program. &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">redirect</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="bp">None</span> <span class="p">):</span>
        <span class="n">wx</span><span class="o">.</span><span class="n">App</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">redirect</span><span class="p">,</span> <span class="n">filename</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">evtloop</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">EventLoop</span><span class="p">()</span>
        <span class="n">wx</span><span class="o">.</span><span class="n">EventLoop</span><span class="o">.</span><span class="n">SetActive</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">evtloop</span><span class="p">)</span> 
        
        <span class="bp">self</span><span class="o">.</span><span class="n">x_log</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y_log</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">markers</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">initialize_dict_positioners</span><span class="p">()</span>
        
        <span class="sd">&quot;&quot;&quot; The parent frame aptcontrols holds the controls provided by APT/ThorLabs</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frame_aptcontrols</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Frame</span><span class="p">(</span> <span class="bp">None</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">ID_ANY</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s">&#39;pyPL -- APT Controls&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">Size</span><span class="p">(</span><span class="mi">1400</span><span class="p">,</span><span class="mi">220</span><span class="p">)</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">panel_aptcontrols</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Panel</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">frame_aptcontrols</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">ID_ANY</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frame_aptcontrols</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span> <span class="n">wx</span><span class="o">.</span><span class="n">EVT_CLOSE</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_close_frame_aptcontrols</span> <span class="p">)</span>

        <span class="sd">&quot;&quot;&quot; initframe will popup temporarily during initialization of motors, but it may not</span>
<span class="sd">            display its innards because we don&#39;t run MainLoop until after the initialization. see</span>
<span class="sd">            http://www.keyongtech.com/4889688-wxpython-before-mainloop</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">initframe</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Frame</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">frame_aptcontrols</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">ID_ANY</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s">&#39;pyPosition is initializing...&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">Size</span><span class="p">(</span><span class="mi">550</span><span class="p">,</span> <span class="mi">70</span><span class="p">)</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">initpanel</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Panel</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">initframe</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">ID_ANY</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hsizer</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">BoxSizer</span><span class="p">(</span> <span class="n">wx</span><span class="o">.</span><span class="n">HORIZONTAL</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">inittext</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">StaticText</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">initpanel</span><span class="p">,</span> 
                                  <span class="n">label</span><span class="o">=</span><span class="s">&#39;Initializing piezos &amp; motors, takes a few seconds... MAKE SURE ALL ARE HOMED/ZEROED!&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hsizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">inittext</span><span class="p">,</span> <span class="n">flag</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ALL</span><span class="o">|</span><span class="n">wx</span><span class="o">.</span><span class="n">CENTER</span><span class="p">,</span> <span class="n">border</span><span class="o">=</span><span class="mi">3</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">button_HideInitWindow</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">initpanel</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">ID_ANY</span><span class="p">,</span> <span class="s">&#39;Dismiss&#39;</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hsizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">button_HideInitWindow</span><span class="p">,</span> <span class="n">flag</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ALL</span><span class="o">|</span><span class="n">wx</span><span class="o">.</span><span class="n">CENTER</span><span class="p">,</span> <span class="n">border</span><span class="o">=</span><span class="mi">3</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">button_HideInitWindow</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span> <span class="n">wx</span><span class="o">.</span><span class="n">EVT_BUTTON</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_button_clicked_hide_init_window</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">initpanel</span><span class="o">.</span><span class="n">SetSizer</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">hsizer</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">initframe</span><span class="o">.</span><span class="n">Center</span><span class="p">()</span>
        <span class="c">#self.initframe.Show()</span>
        
        <span class="c"># create pubsub receivers to monitor events from daemon threads</span>
        <span class="n">Publisher</span><span class="p">()</span><span class="o">.</span><span class="n">subscribe</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_moved_joystick</span><span class="p">,</span> <span class="s">&quot;joystick-moved&quot;</span> <span class="p">)</span>
        <span class="n">Publisher</span><span class="p">()</span><span class="o">.</span><span class="n">subscribe</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_moved_motor</span><span class="p">,</span> <span class="s">&quot;motor-moved&quot;</span> <span class="p">)</span>


<div class="viewcode-block" id="MainApp.add_menu_bar"><a class="viewcode-back" href="../pyPL.html#pyPL.MainApp.add_menu_bar">[docs]</a>    <span class="k">def</span> <span class="nf">add_menu_bar</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; File menu</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">file_menu</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Menu</span><span class="p">()</span>
        <span class="n">file_menu</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span> <span class="n">ID_File_Exit</span><span class="p">,</span> <span class="s">&quot;E&amp;xit&quot;</span><span class="p">,</span> <span class="s">&quot;Terminate the program&quot;</span> <span class="p">)</span>
        <span class="n">wx</span><span class="o">.</span><span class="n">EVT_MENU</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">ID_File_Exit</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_menu_file_exit</span> <span class="p">)</span>

        <span class="n">menuBar</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">MenuBar</span><span class="p">()</span>
        <span class="n">menuBar</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span> <span class="n">file_menu</span><span class="p">,</span> <span class="s">&quot;&amp;File&quot;</span> <span class="p">)</span>

        <span class="sd">&quot;&quot;&quot; Window menu</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">window_menu</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Menu</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">numpiezo</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">window_menu</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span> <span class="n">ID_Window_Piezo</span><span class="p">,</span> <span class="s">&quot;py&amp;Piezos&quot;</span><span class="p">,</span> <span class="s">&quot;Custom piezo controls&quot;</span> <span class="p">)</span>
            <span class="n">wx</span><span class="o">.</span><span class="n">EVT_MENU</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">ID_Window_Piezo</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_menu_window_pypiezo</span> <span class="p">)</span>
    
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nummotor</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">window_menu</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span> <span class="n">ID_Window_PositionLog</span><span class="p">,</span> <span class="s">&quot;Position Log&quot;</span><span class="p">,</span> <span class="s">&quot;A graphical log of motor positions&quot;</span> <span class="p">)</span>
            <span class="n">wx</span><span class="o">.</span><span class="n">EVT_MENU</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">ID_Window_PositionLog</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_menu_window_position_log</span> <span class="p">)</span>
    
            <span class="n">window_menu</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span> <span class="n">ID_Window_ImageNavigation</span><span class="p">,</span> <span class="s">&quot;Image Navigation&quot;</span><span class="p">,</span> <span class="s">&quot;Move relative to a picture of the sample&quot;</span> <span class="p">)</span>
            <span class="n">wx</span><span class="o">.</span><span class="n">EVT_MENU</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">ID_Window_ImageNavigation</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_menu_window_image_navigation</span> <span class="p">)</span>
    
        <span class="n">window_menu</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span> <span class="n">ID_Window_Raster</span><span class="p">,</span> <span class="s">&quot;&amp;Raster&quot;</span><span class="p">,</span> <span class="s">&quot;Raster scan using piezos&quot;</span> <span class="p">)</span>
        <span class="n">wx</span><span class="o">.</span><span class="n">EVT_MENU</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">ID_Window_Raster</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_menu_window_raster</span> <span class="p">)</span>
        
        <span class="n">window_menu</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span> <span class="n">ID_Window_WinSpec</span><span class="p">,</span> <span class="s">&quot;Win&amp;Spec Time Step&quot;</span><span class="p">,</span> <span class="s">&quot;Acquire spectra every ## seconds&quot;</span> <span class="p">)</span>
        <span class="n">wx</span><span class="o">.</span><span class="n">EVT_MENU</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">ID_Window_WinSpec</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_menu_window_winspec</span> <span class="p">)</span>
        
        <span class="n">window_menu</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span> <span class="n">ID_Window_Wobble</span><span class="p">,</span> <span class="s">&quot;&amp;Wobbler&quot;</span><span class="p">,</span> <span class="s">&quot;Adjust wobbler settings&quot;</span> <span class="p">)</span>
        <span class="n">wx</span><span class="o">.</span><span class="n">EVT_MENU</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">ID_Window_Wobble</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_menu_window_wobble</span> <span class="p">)</span>
        
        <span class="n">menuBar</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span> <span class="n">window_menu</span><span class="p">,</span> <span class="s">&quot;&amp;Window&quot;</span> <span class="p">)</span>

        <span class="sd">&quot;&quot;&quot; Misc menu</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">misc_menu</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Menu</span><span class="p">()</span>

        <span class="n">misc_menu</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span> <span class="n">ID_Joystick_Reinitialize</span><span class="p">,</span> <span class="s">&quot;Reset Joystick&quot;</span><span class="p">,</span> <span class="s">&quot;Re-initialize joystick(s)&quot;</span><span class="p">)</span>
        <span class="n">wx</span><span class="o">.</span><span class="n">EVT_MENU</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">ID_Joystick_Reinitialize</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_menu_misc_reinitialize_joystick</span> <span class="p">)</span>

        <span class="n">menuBar</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span> <span class="n">misc_menu</span><span class="p">,</span> <span class="s">&quot;&amp;Misc&quot;</span> <span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">frame_aptcontrols</span><span class="o">.</span><span class="n">SetMenuBar</span><span class="p">(</span> <span class="n">menuBar</span> <span class="p">)</span>

</div>
<div class="viewcode-block" id="MainApp.initialize_dict_positioners"><a class="viewcode-back" href="../pyPL.html#pyPL.MainApp.initialize_dict_positioners">[docs]</a>    <span class="k">def</span> <span class="nf">initialize_dict_positioners</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; they&#39;re all None by default and</span>
<span class="sd">            will only acquire a value if the</span>
<span class="sd">            appropriate positioner is detected.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">positioners</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">positioners</span><span class="p">[</span><span class="s">&#39;piezoX&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">positioners</span><span class="p">[</span><span class="s">&#39;piezoY&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">positioners</span><span class="p">[</span><span class="s">&#39;piezoZ&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">positioners</span><span class="p">[</span><span class="s">&#39;motorX&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">positioners</span><span class="p">[</span><span class="s">&#39;motorY&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">positioners</span><span class="p">[</span><span class="s">&#39;motorZ&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span>

</div>
    <span class="k">def</span> <span class="nf">make_pypiezoframe</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">numpiezo</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pypiezoframe</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Frame</span><span class="p">(</span> <span class="bp">None</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ID_ANY</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s">&#39;pyPiezos&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">Size</span><span class="p">(</span><span class="mi">350</span><span class="p">,</span> <span class="mi">320</span><span class="p">)</span> <span class="p">)</span>
            <span class="n">pyPiezo</span><span class="o">.</span><span class="n">MainPanel</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">pypiezoframe</span><span class="p">,</span> <span class="n">positioners</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">positioners</span> <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pypiezoframe</span><span class="o">.</span><span class="n">Centre</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pypiezoframe</span><span class="o">.</span><span class="n">Show</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
        

    <span class="k">def</span> <span class="nf">on_button_clicked_hide_init_window</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">event</span> <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">initframe</span><span class="o">.</span><span class="n">Hide</span><span class="p">()</span>
        

    <span class="k">def</span> <span class="nf">on_close_frame_aptcontrols</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">event</span> <span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">position_monitor_thread</span><span class="o">.</span><span class="n">abort</span><span class="p">()</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">pass</span>
        
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pypiezoframe</span><span class="o">.</span><span class="n">Close</span><span class="p">()</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">pass</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rasterframe</span><span class="o">.</span><span class="n">Close</span><span class="p">()</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">pass</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">position_log</span><span class="o">.</span><span class="n">Close</span><span class="p">()</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">pass</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">image_navigation</span><span class="o">.</span><span class="n">Close</span><span class="p">()</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">pass</span>

        <span class="k">for</span> <span class="n">positioner</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">positioners</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">positioners</span><span class="p">[</span><span class="n">positioner</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">positioners</span><span class="p">[</span><span class="n">positioner</span><span class="p">][</span><span class="s">&#39;control&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">ctrl</span><span class="o">.</span><span class="n">StopCtrl</span><span class="p">()</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="k">pass</span>
        
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">apt_system</span><span class="o">.</span><span class="n">ctrl</span><span class="o">.</span><span class="n">StopCtrl</span><span class="p">()</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">pass</span>

        <span class="k">print</span> <span class="s">&quot;done.&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frame_aptcontrols</span><span class="o">.</span><span class="n">Destroy</span><span class="p">()</span>
        
       
<div class="viewcode-block" id="MainApp.on_menu_file_exit"><a class="viewcode-back" href="../pyPL.html#pyPL.MainApp.on_menu_file_exit">[docs]</a>    <span class="k">def</span> <span class="nf">on_menu_file_exit</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">evt</span> <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This is executed when the user clicks the &#39;Exit&#39; option</span>
<span class="sd">        under the &#39;File&#39; menu.  We ask the user if they *really*</span>
<span class="sd">        want to exit, then close everything down if they do.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">dlg</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">MessageDialog</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">frame_aptcontrols</span><span class="p">,</span> <span class="s">&#39;Exit Program?&#39;</span><span class="p">,</span> 
            <span class="bp">self</span><span class="o">.</span><span class="n">frame_aptcontrols</span><span class="o">.</span><span class="n">GetTitle</span><span class="p">()</span><span class="o">+</span><span class="s">&quot; --&gt; Exit&quot;</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">YES_NO</span> <span class="o">|</span> <span class="n">wx</span><span class="o">.</span><span class="n">ICON_QUESTION</span> <span class="p">)</span>
        <span class="k">if</span> <span class="n">dlg</span><span class="o">.</span><span class="n">ShowModal</span><span class="p">()</span> <span class="o">==</span> <span class="n">wx</span><span class="o">.</span><span class="n">ID_YES</span><span class="p">:</span>
            <span class="n">dlg</span><span class="o">.</span><span class="n">Destroy</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">frame_aptcontrols</span><span class="o">.</span><span class="n">Close</span><span class="p">(</span> <span class="bp">True</span> <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">dlg</span><span class="o">.</span><span class="n">Destroy</span><span class="p">()</span>

            </div>
    <span class="k">def</span> <span class="nf">on_menu_misc_reinitialize_joystick</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">event</span> <span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">joystick_thread</span><span class="o">.</span><span class="n">isAlive</span><span class="p">():</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="kn">import</span> <span class="nn">pygame</span>
            <span class="n">pygame</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">joystick_thread</span> <span class="o">=</span> <span class="n">JoystickThread</span><span class="p">(</span> <span class="bp">self</span> <span class="p">)</span>
            

    <span class="k">def</span> <span class="nf">on_menu_window_image_navigation</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">event</span> <span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">image_navigation</span><span class="o">.</span><span class="n">Show</span><span class="p">(</span> <span class="bp">True</span> <span class="p">):</span> 
                <span class="bp">self</span><span class="o">.</span><span class="n">image_navigation</span><span class="o">.</span><span class="n">Raise</span><span class="p">()</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nummotor</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">image_navigation</span> <span class="o">=</span> <span class="n">ImageNavigation</span><span class="o">.</span><span class="n">MainFrame</span><span class="p">(</span> <span class="n">parent</span><span class="o">=</span><span class="bp">self</span> <span class="p">)</span>
        
        
    <span class="k">def</span> <span class="nf">on_menu_window_position_log</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">event</span> <span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">position_log</span><span class="o">.</span><span class="n">Show</span><span class="p">(</span> <span class="bp">True</span> <span class="p">):</span> 
                <span class="bp">self</span><span class="o">.</span><span class="n">position_log</span><span class="o">.</span><span class="n">Raise</span><span class="p">()</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nummotor</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">position_log</span> <span class="o">=</span> <span class="n">PositionLogger</span><span class="o">.</span><span class="n">MainFrame</span><span class="p">(</span> <span class="n">parent</span><span class="o">=</span><span class="bp">self</span> <span class="p">)</span>
                

    <span class="k">def</span> <span class="nf">on_menu_window_pypiezo</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">event</span> <span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">pypiezoframe</span><span class="o">.</span><span class="n">Show</span><span class="p">(</span> <span class="bp">True</span> <span class="p">):</span> 
                <span class="bp">self</span><span class="o">.</span><span class="n">pypiezoframe</span><span class="o">.</span><span class="n">Raise</span><span class="p">()</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">make_pypiezoframe</span><span class="p">()</span>


    <span class="k">def</span> <span class="nf">on_menu_window_raster</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">event</span> <span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">rasterframe</span><span class="o">.</span><span class="n">Show</span><span class="p">(</span> <span class="bp">True</span> <span class="p">):</span> 
                <span class="bp">self</span><span class="o">.</span><span class="n">rasterframe</span><span class="o">.</span><span class="n">Raise</span><span class="p">()</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">numpiezo</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="kn">import</span> <span class="nn">pyRaster</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">rasterframe</span> <span class="o">=</span> <span class="n">pyRaster</span><span class="o">.</span><span class="n">Raster</span><span class="p">(</span> <span class="bp">self</span> <span class="p">)</span>
            

    <span class="k">def</span> <span class="nf">on_menu_window_winspec</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">event</span> <span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">WinspecTimeStepFrame</span><span class="o">.</span><span class="n">Show</span><span class="p">(</span> <span class="bp">True</span> <span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">WinspecTimeStepFrame</span><span class="o">.</span><span class="n">Raise</span><span class="p">()</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="kn">import</span> <span class="nn">WinspecTimeStep</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">WinspecTimeStepFrame</span> <span class="o">=</span> <span class="n">WinspecTimeStep</span><span class="o">.</span><span class="n">MakeMainWindow</span><span class="p">()</span>
    

    <span class="k">def</span> <span class="nf">on_menu_window_wobble</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">event</span> <span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">wobbleAdjustmentWindow</span><span class="o">.</span><span class="n">Show</span><span class="p">(</span> <span class="bp">True</span> <span class="p">):</span> 
                <span class="bp">self</span><span class="o">.</span><span class="n">wobbleAdjustmentWindow</span><span class="o">.</span><span class="n">Raise</span><span class="p">()</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">app</span><span class="o">.</span><span class="n">wobbler</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">wobbleAdjustmentWindow</span> <span class="o">=</span> <span class="n">app</span><span class="o">.</span><span class="n">wobbler</span><span class="o">.</span><span class="n">wobbleParametersAdjustmentWindow</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">frame_aptcontrols</span> <span class="p">)</span>
            <span class="k">except</span> <span class="ne">NameError</span><span class="p">:</span>
                <span class="k">print</span> <span class="s">&quot;no wobbler&quot;</span>


<div class="viewcode-block" id="MainApp.on_moved_joystick"><a class="viewcode-back" href="../pyPL.html#pyPL.MainApp.on_moved_joystick">[docs]</a>    <span class="k">def</span> <span class="nf">on_moved_joystick</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">msg</span> <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        receives data from the thread controlling the joystick and updates position log accordingly</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">False</span><span class="p">:</span>
            <span class="c"># position is now monitored continuously with a separate thread.</span>
        <span class="c">#if msg.data is &#39;motors&#39;:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nummotor</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">positioners</span><span class="p">[</span><span class="s">&#39;motorX&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">x_log</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">positioners</span><span class="p">[</span><span class="s">&#39;motorX&#39;</span><span class="p">][</span><span class="s">&#39;control&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">GetPosition</span><span class="p">()</span> <span class="p">)</span>

                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">positioners</span><span class="p">[</span><span class="s">&#39;motorY&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">y_log</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">positioners</span><span class="p">[</span><span class="s">&#39;motorY&#39;</span><span class="p">][</span><span class="s">&#39;control&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">GetPosition</span><span class="p">()</span> <span class="p">)</span>
                
                <span class="k">try</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">position_log</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">position_log</span><span class="o">.</span><span class="n">update_plot</span><span class="p">()</span>
                <span class="k">except</span> <span class="p">(</span> <span class="ne">NameError</span><span class="p">,</span> <span class="ne">AttributeError</span> <span class="p">):</span>
                    <span class="sd">&quot;&quot;&quot; haven&#39;t yet made a figure&quot;&quot;&quot;</span>
                    <span class="k">pass</span>
    
</div>
<div class="viewcode-block" id="MainApp.on_moved_motor"><a class="viewcode-back" href="../pyPL.html#pyPL.MainApp.on_moved_motor">[docs]</a>    <span class="k">def</span> <span class="nf">on_moved_motor</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">msg</span> <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; receives info from the thread monitoring the motor positions, then updates position log</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">position_log</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">position_log</span><span class="o">.</span><span class="n">update_plot</span><span class="p">()</span>
        <span class="k">except</span> <span class="p">(</span> <span class="ne">NameError</span><span class="p">,</span> <span class="ne">AttributeError</span> <span class="p">):</span>
            <span class="sd">&quot;&quot;&quot; haven&#39;t yet made a figure&quot;&quot;&quot;</span>
            <span class="k">pass</span>

        
        </div></div>
<span class="kn">import</span> <span class="nn">threading</span>
<div class="viewcode-block" id="JoystickThread"><a class="viewcode-back" href="../pyPL.html#pyPL.JoystickThread">[docs]</a><span class="k">class</span> <span class="nc">JoystickThread</span><span class="p">(</span> <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span> <span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; We spawn a separate thread for the joystick because pygame (the module we use</span>
<span class="sd">        to monitor the joystick) has its own event loop.</span>
<span class="sd">    &quot;&quot;&quot;</span> 
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">app</span><span class="p">,</span> <span class="n">positioners</span> <span class="p">):</span>
        <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">app</span> <span class="o">=</span> <span class="n">app</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">positioners</span> <span class="o">=</span> <span class="n">positioners</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setDaemon</span><span class="p">(</span> <span class="bp">True</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
        
<div class="viewcode-block" id="JoystickThread.run"><a class="viewcode-back" href="../pyPL.html#pyPL.JoystickThread.run">[docs]</a>    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Starts the thread monitoring the joystick. &quot;&quot;&quot;</span>
        <span class="kn">import</span> <span class="nn">joystick_control</span>
        <span class="n">joystick_control</span><span class="o">.</span><span class="n">StartControl</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">positioners</span> <span class="p">)</span>
        
</div></div>
<div class="viewcode-block" id="MotorPositionMonitorThread"><a class="viewcode-back" href="../pyPL.html#pyPL.MotorPositionMonitorThread">[docs]</a><span class="k">class</span> <span class="nc">MotorPositionMonitorThread</span><span class="p">(</span> <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span> <span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; I need to monitor the position with a separate thread so that we just check</span>
<span class="sd">        every x milliseconds. That way it will track when the user moves via the</span>
<span class="sd">        apt controls.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">app</span><span class="p">,</span> <span class="n">positioners</span> <span class="p">):</span>
        <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">app</span> <span class="o">=</span> <span class="n">app</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">positioners</span> <span class="o">=</span> <span class="n">positioners</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x_log</span> <span class="o">=</span> <span class="n">app</span><span class="o">.</span><span class="n">x_log</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y_log</span> <span class="o">=</span> <span class="n">app</span><span class="o">.</span><span class="n">y_log</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_want_abort</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setDaemon</span><span class="p">(</span> <span class="bp">True</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
        
<div class="viewcode-block" id="MotorPositionMonitorThread.run"><a class="viewcode-back" href="../pyPL.html#pyPL.MotorPositionMonitorThread.run">[docs]</a>    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Starts the thread monitoring the motor positions. &quot;&quot;&quot;</span>
        <span class="n">movement_threshold</span> <span class="o">=</span> <span class="mf">0.001</span> <span class="c"># threshold for updating (mm)</span>
        <span class="n">time_interval</span> <span class="o">=</span> <span class="mf">0.3</span> <span class="c"># check this often (seconds)</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_want_abort</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_log</span> <span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">x_log</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">positioners</span><span class="p">[</span><span class="s">&#39;motorX&#39;</span><span class="p">][</span><span class="s">&#39;control&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">GetPosition</span><span class="p">()</span> <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">y_log</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">positioners</span><span class="p">[</span><span class="s">&#39;motorY&#39;</span><span class="p">][</span><span class="s">&#39;control&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">GetPosition</span><span class="p">()</span> <span class="p">)</span>

        <span class="n">prev_position</span> <span class="o">=</span> <span class="n">pylab</span><span class="o">.</span><span class="n">array</span><span class="p">([</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_log</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_log</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="p">])</span>

        <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_want_abort</span><span class="p">:</span>
                <span class="k">return</span>

            <span class="n">current_position</span> <span class="o">=</span> <span class="n">pylab</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">positioners</span><span class="p">[</span><span class="s">&#39;motorX&#39;</span><span class="p">][</span><span class="s">&#39;control&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">GetPosition</span><span class="p">(),</span>
                                            <span class="bp">self</span><span class="o">.</span><span class="n">positioners</span><span class="p">[</span><span class="s">&#39;motorY&#39;</span><span class="p">][</span><span class="s">&#39;control&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">GetPosition</span><span class="p">()</span> <span class="p">])</span>
            <span class="k">if</span> <span class="nb">any</span><span class="p">(</span> <span class="nb">abs</span><span class="p">(</span><span class="n">current_position</span><span class="o">-</span><span class="n">prev_position</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">movement_threshold</span> <span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">x_log</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">current_position</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">y_log</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">current_position</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="p">)</span>
                
                <span class="n">Publisher</span><span class="p">()</span><span class="o">.</span><span class="n">sendMessage</span><span class="p">(</span><span class="s">&quot;motor-moved&quot;</span><span class="p">,</span> <span class="s">&#39;True&#39;</span><span class="p">)</span>

            <span class="n">prev_position</span> <span class="o">=</span> <span class="n">current_position</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span> <span class="n">time_interval</span> <span class="p">)</span>
</div>
<div class="viewcode-block" id="MotorPositionMonitorThread.abort"><a class="viewcode-back" href="../pyPL.html#pyPL.MotorPositionMonitorThread.abort">[docs]</a>    <span class="k">def</span> <span class="nf">abort</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Sets a flag to signal the thread that we want it to terminate. &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_want_abort</span> <span class="o">=</span> <span class="bp">True</span>
            
</div></div>
<span class="k">if</span> <span class="n">__name__</span><span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span> 
    <span class="n">app</span> <span class="o">=</span> <span class="n">MainApp</span><span class="p">()</span>

    <span class="sd">&quot;&quot;&quot; Add motor and piezo controls to the panel_aptcontrols</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="sd">&quot;&quot;&quot; </span>
<span class="sd">    I included the &#39;direction&#39; flag in the positioners dict in case the stage axis was inverted w.r.t. the camera:</span>
<span class="sd">    that way we could flip the direction of the slider so that, e.g., dragging the slider</span>
<span class="sd">    to the right made the sample move to the right on the camera.</span>
<span class="sd">    </span>
<span class="sd">    The serial numbers here are actually the serial numbers of the controller cards, </span>
<span class="sd">    not the motors/piezos themselves.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">box_allcontrols</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">BoxSizer</span><span class="p">(</span> <span class="n">wx</span><span class="o">.</span><span class="n">HORIZONTAL</span> <span class="p">)</span>

    <span class="n">box_system</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">BoxSizer</span><span class="p">(</span> <span class="n">wx</span><span class="o">.</span><span class="n">VERTICAL</span> <span class="p">)</span>
    <span class="n">app</span><span class="o">.</span><span class="n">apt_system</span> <span class="o">=</span> <span class="n">APTSystem</span><span class="p">(</span> <span class="n">app</span><span class="o">.</span><span class="n">panel_aptcontrols</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">SUNKEN_BORDER</span> <span class="p">)</span>
    <span class="c">#box_system.Add( app.apt_system )</span>
    <span class="n">box_allcontrols</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span> <span class="n">app</span><span class="o">.</span><span class="n">apt_system</span><span class="p">,</span> <span class="n">proportion</span><span class="o">=</span><span class="mi">0</span> <span class="p">)</span>
    
    <span class="sd">&quot;&quot;&quot; Initialize piezos:</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">numpiezo</span> <span class="o">=</span> <span class="n">app</span><span class="o">.</span><span class="n">apt_system</span><span class="o">.</span><span class="n">GetNumPiezoControllerCards</span><span class="p">()</span>
    <span class="n">app</span><span class="o">.</span><span class="n">numpiezo</span> <span class="o">=</span> <span class="n">numpiezo</span>
    <span class="k">print</span> <span class="s">&quot;num piezo controller cards detected:&quot;</span><span class="p">,</span> <span class="n">numpiezo</span>

    <span class="k">if</span> <span class="n">numpiezo</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">box_piezos</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">BoxSizer</span><span class="p">(</span> <span class="n">wx</span><span class="o">.</span><span class="n">VERTICAL</span> <span class="p">)</span>
        <span class="n">serialnums</span> <span class="o">=</span> <span class="n">app</span><span class="o">.</span><span class="n">apt_system</span><span class="o">.</span><span class="n">GetPiezoSerialNumbers</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">numpiezo</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">detected_piezoX_serialnum</span><span class="p">,</span> <span class="n">detected_piezoY_serialnum</span> <span class="o">=</span> <span class="n">serialnums</span>
        <span class="k">elif</span> <span class="n">numpiezo</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="n">detected_piezoX_serialnum</span><span class="p">,</span> <span class="n">detected_piezoY_serialnum</span><span class="p">,</span> <span class="n">detected_piezoZ_serialnum</span> <span class="o">=</span> <span class="n">serialnums</span>
        
        <span class="n">hard_coded_piezoX_SerialNum</span> <span class="o">=</span> <span class="mi">91823861</span>
        <span class="k">if</span> <span class="n">detected_piezoX_serialnum</span> <span class="o">!=</span> <span class="n">hard_coded_piezoX_SerialNum</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&quot;PiezoX is not familiar (s/n: </span><span class="si">%d</span><span class="s">); direction/polarity may be off. See source code.&quot;</span> <span class="o">%</span> <span class="n">detected_piezoX_serialnum</span>
            
        <span class="n">piezoX</span> <span class="o">=</span> <span class="n">APTPiezo</span><span class="p">(</span> <span class="n">app</span><span class="o">.</span><span class="n">panel_aptcontrols</span><span class="p">,</span> <span class="n">HWSerialNum</span><span class="o">=</span><span class="n">detected_piezoX_serialnum</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">SUNKEN_BORDER</span> <span class="p">)</span>
        <span class="n">piezoX</span><span class="o">.</span><span class="n">SetToDisplayPosition</span><span class="p">()</span>
        <span class="n">piezoX</span><span class="o">.</span><span class="n">SetToClosedLoopMode</span><span class="p">()</span>
        <span class="c">#print &quot;piezoX position:&quot;, piezoX.GetPosition() # FIX THIS!!! Why doesn&#39;t this method work?</span>
        <span class="c">#box_piezos.Add( piezoX, proportion=1, flag=wx.EXPAND )</span>
        <span class="n">box_allcontrols</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span> <span class="n">piezoX</span><span class="p">,</span> <span class="n">proportion</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">flag</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">EXPAND</span> <span class="p">)</span>
        <span class="n">app</span><span class="o">.</span><span class="n">positioners</span><span class="p">[</span><span class="s">&#39;piezoX&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span> <span class="n">control</span><span class="o">=</span><span class="n">piezoX</span><span class="p">,</span> <span class="n">direction</span><span class="o">=-</span><span class="mi">1</span> <span class="p">)</span>
        
        <span class="n">hard_coded_piezoY_SerialNum</span> <span class="o">=</span> <span class="mi">91823862</span>
        <span class="k">if</span> <span class="n">detected_piezoY_serialnum</span> <span class="o">!=</span> <span class="n">hard_coded_piezoY_SerialNum</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&quot;PiezoY is not familiar (s/n: </span><span class="si">%d</span><span class="s">); direction/polarity may be off. See source code.&quot;</span> <span class="o">%</span> <span class="n">detected_piezoY_serialnum</span>
        
        <span class="n">piezoY</span> <span class="o">=</span> <span class="n">APTPiezo</span><span class="p">(</span> <span class="n">app</span><span class="o">.</span><span class="n">panel_aptcontrols</span><span class="p">,</span> <span class="n">HWSerialNum</span><span class="o">=</span><span class="n">detected_piezoY_serialnum</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">SUNKEN_BORDER</span> <span class="p">)</span>
        <span class="n">piezoY</span><span class="o">.</span><span class="n">SetToDisplayPosition</span><span class="p">()</span>
        <span class="n">piezoY</span><span class="o">.</span><span class="n">SetToClosedLoopMode</span><span class="p">()</span>
        <span class="c">#box_piezos.Add( piezoY, proportion=1, flag=wx.EXPAND )</span>
        <span class="n">box_allcontrols</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span> <span class="n">piezoY</span><span class="p">,</span> <span class="n">proportion</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">flag</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">EXPAND</span> <span class="p">)</span>
        <span class="n">app</span><span class="o">.</span><span class="n">positioners</span><span class="p">[</span><span class="s">&#39;piezoY&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span> <span class="n">control</span><span class="o">=</span><span class="n">piezoY</span><span class="p">,</span> <span class="n">direction</span><span class="o">=</span><span class="mi">1</span> <span class="p">)</span>
        
    <span class="k">if</span> <span class="n">numpiezo</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
        <span class="n">hard_coded_piezoZ_SerialNum</span> <span class="o">=</span> <span class="mi">91823863</span>
        <span class="k">if</span> <span class="n">detected_piezoZ_serialnum</span> <span class="o">!=</span> <span class="n">hard_coded_piezoZ_SerialNum</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&quot;PiezoZ is not familiar (s/n: </span><span class="si">%d</span><span class="s">); direction/polarity may be off. See source code.&quot;</span> <span class="o">%</span> <span class="n">detected_piezoZ_serialnum</span>
    
        <span class="n">piezoZ</span> <span class="o">=</span> <span class="n">APTPiezo</span><span class="p">(</span> <span class="n">app</span><span class="o">.</span><span class="n">panel_aptcontrols</span><span class="p">,</span> <span class="n">HWSerialNum</span><span class="o">=</span><span class="n">detected_piezoZ_serialnum</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">SUNKEN_BORDER</span> <span class="p">)</span>
        <span class="n">piezoZ</span><span class="o">.</span><span class="n">SetToDisplayPosition</span><span class="p">()</span>
        <span class="n">piezoZ</span><span class="o">.</span><span class="n">SetToClosedLoopMode</span><span class="p">()</span>
        <span class="c">#box_piezos.Add( piezoZ, proportion=1, flag=wx.EXPAND )</span>
        <span class="n">box_allcontrols</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span> <span class="n">piezoZ</span><span class="p">,</span> <span class="n">proportion</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">flag</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">EXPAND</span> <span class="p">)</span>
        <span class="n">app</span><span class="o">.</span><span class="n">positioners</span><span class="p">[</span><span class="s">&#39;piezoZ&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span> <span class="n">control</span><span class="o">=</span><span class="n">piezoZ</span><span class="p">,</span> <span class="n">direction</span><span class="o">=</span><span class="mi">1</span> <span class="p">)</span>





    <span class="sd">&quot;&quot;&quot; Initialize motors:</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">nummotor</span> <span class="o">=</span> <span class="n">app</span><span class="o">.</span><span class="n">apt_system</span><span class="o">.</span><span class="n">GetNumMotorControllerCards</span><span class="p">()</span>
    <span class="n">app</span><span class="o">.</span><span class="n">nummotor</span> <span class="o">=</span> <span class="n">nummotor</span>
    <span class="k">print</span> <span class="s">&quot;num motor controller cards detected:&quot;</span><span class="p">,</span> <span class="n">nummotor</span>

    <span class="k">if</span> <span class="n">nummotor</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">box_motors</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">BoxSizer</span><span class="p">(</span> <span class="n">wx</span><span class="o">.</span><span class="n">VERTICAL</span> <span class="p">)</span>

        <span class="n">motorserialnums</span> <span class="o">=</span> <span class="n">app</span><span class="o">.</span><span class="n">apt_system</span><span class="o">.</span><span class="n">GetMotorSerialNumbers</span><span class="p">()</span>
        
        <span class="k">if</span> <span class="n">nummotor</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">detected_motorX_serialnum</span> <span class="o">=</span> <span class="n">motorserialnums</span>
        <span class="k">elif</span> <span class="n">nummotor</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">detected_motorX_serialnum</span><span class="p">,</span> <span class="n">detected_motorY_serialnum</span> <span class="o">=</span> <span class="n">motorserialnums</span>
        <span class="k">elif</span> <span class="n">nummotor</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="n">detected_motorX_serialnum</span><span class="p">,</span> <span class="n">detected_motorY_serialnum</span><span class="p">,</span> <span class="n">detected_motorZ_serialnum</span> <span class="o">=</span> <span class="n">motorserialnums</span>

        <span class="n">hard_coded_motorX_SerialNum</span> <span class="o">=</span> <span class="mi">90823946</span>
        <span class="k">if</span> <span class="n">detected_motorX_serialnum</span> <span class="o">!=</span> <span class="n">hard_coded_motorX_SerialNum</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&quot;MotorX is not familiar (s/n: </span><span class="si">%d</span><span class="s">); direction/polarity may be off. See source code.&quot;</span> <span class="o">%</span> <span class="n">detected_motorX_serialnum</span>
        <span class="n">motorX</span> <span class="o">=</span> <span class="n">APTMotor</span><span class="p">(</span> <span class="n">app</span><span class="o">.</span><span class="n">panel_aptcontrols</span><span class="p">,</span> <span class="n">HWSerialNum</span><span class="o">=</span><span class="n">detected_motorX_serialnum</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">SUNKEN_BORDER</span> <span class="p">)</span>
        <span class="n">motorX</span><span class="o">.</span><span class="n">SetStageAxisInfo</span><span class="p">(</span> <span class="n">minpos</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">maxpos</span><span class="o">=</span><span class="mf">50.0</span> <span class="p">)</span>
        <span class="n">motorX</span><span class="o">.</span><span class="n">SetHomeParams</span><span class="p">()</span>
        <span class="n">motorX</span><span class="o">.</span><span class="n">SetBLashDist</span><span class="p">(</span> <span class="n">backlash</span><span class="o">=</span><span class="mf">0.001</span> <span class="p">)</span>
        <span class="n">motorX</span><span class="o">.</span><span class="n">SetVelParams</span><span class="p">()</span>
        <span class="c">#box_motors.Add( motorX, proportion=1, flag=wx.EXPAND )</span>
        <span class="n">box_allcontrols</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span> <span class="n">motorX</span><span class="p">,</span> <span class="n">proportion</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">flag</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">EXPAND</span> <span class="p">)</span>
        <span class="n">app</span><span class="o">.</span><span class="n">positioners</span><span class="p">[</span><span class="s">&#39;motorX&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span> <span class="n">control</span><span class="o">=</span><span class="n">motorX</span><span class="p">,</span> <span class="n">direction</span><span class="o">=</span><span class="mi">1</span> <span class="p">)</span>
    
        <span class="k">if</span> <span class="n">nummotor</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">hard_coded_motorY_SerialNum</span> <span class="o">=</span> <span class="mi">90823947</span>
            <span class="k">if</span> <span class="n">detected_motorY_serialnum</span> <span class="o">!=</span> <span class="n">hard_coded_motorY_SerialNum</span><span class="p">:</span>
                <span class="k">print</span> <span class="s">&quot;MotorY is not familiar (s/n: </span><span class="si">%d</span><span class="s">); direction/polarity may be off. See source code.&quot;</span> <span class="o">%</span> <span class="n">detected_motorY_serialnum</span>
            <span class="n">motorY</span> <span class="o">=</span> <span class="n">APTMotor</span><span class="p">(</span> <span class="n">app</span><span class="o">.</span><span class="n">panel_aptcontrols</span><span class="p">,</span> <span class="n">HWSerialNum</span><span class="o">=</span><span class="n">detected_motorY_serialnum</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">SUNKEN_BORDER</span> <span class="p">)</span>
            <span class="n">motorY</span><span class="o">.</span><span class="n">SetStageAxisInfo</span><span class="p">(</span> <span class="n">minpos</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">maxpos</span><span class="o">=</span><span class="mf">49.0</span> <span class="p">)</span>
            <span class="n">motorY</span><span class="o">.</span><span class="n">SetHomeParams</span><span class="p">()</span>
            <span class="n">motorY</span><span class="o">.</span><span class="n">SetBLashDist</span><span class="p">(</span> <span class="n">backlash</span><span class="o">=</span><span class="mf">0.001</span> <span class="p">)</span>
            <span class="n">motorY</span><span class="o">.</span><span class="n">SetVelParams</span><span class="p">()</span>
            <span class="c">#box_motors.Add( motorY, proportion=1, flag=wx.EXPAND )</span>
            <span class="n">box_allcontrols</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span> <span class="n">motorY</span><span class="p">,</span> <span class="n">proportion</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">flag</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">EXPAND</span> <span class="p">)</span>
            <span class="n">app</span><span class="o">.</span><span class="n">positioners</span><span class="p">[</span><span class="s">&#39;motorY&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span> <span class="n">control</span><span class="o">=</span><span class="n">motorY</span><span class="p">,</span> <span class="n">direction</span><span class="o">=-</span><span class="mi">1</span> <span class="p">)</span>

        <span class="k">if</span> <span class="n">nummotor</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="n">hard_coded_motorZ_SerialNum</span> <span class="o">=</span> <span class="mi">90823948</span>
            <span class="k">if</span> <span class="n">detected_motorZ_serialnum</span> <span class="o">!=</span> <span class="n">hard_coded_motorZ_SerialNum</span><span class="p">:</span>
                <span class="k">print</span> <span class="s">&quot;MotorZ is not familiar (s/n: </span><span class="si">%d</span><span class="s">); direction/polarity may be off. See source code.&quot;</span> <span class="o">%</span> <span class="n">detected_motorZ_serialnum</span>
            <span class="n">motorZ</span> <span class="o">=</span> <span class="n">APTMotor</span><span class="p">(</span> <span class="n">app</span><span class="o">.</span><span class="n">panel_aptcontrols</span><span class="p">,</span> <span class="n">HWSerialNum</span><span class="o">=</span><span class="n">detected_motorZ_serialnum</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">SUNKEN_BORDER</span> <span class="p">)</span>
            <span class="n">motorZ</span><span class="o">.</span><span class="n">SetStageAxisInfo</span><span class="p">(</span> <span class="n">minpos</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">maxpos</span><span class="o">=</span><span class="mf">12.0</span> <span class="p">)</span> <span class="c"># I haven&#39;t actually adjusted this one yet; not used.</span>
            <span class="n">motorZ</span><span class="o">.</span><span class="n">SetHomeParams</span><span class="p">()</span>
            <span class="n">motorZ</span><span class="o">.</span><span class="n">SetBLashDist</span><span class="p">(</span> <span class="n">backlash</span><span class="o">=</span><span class="mf">0.001</span> <span class="p">)</span>
            <span class="n">motorZ</span><span class="o">.</span><span class="n">SetVelParams</span><span class="p">()</span>
            <span class="c">#box_motors.Add( motorZ, proportion=1, flag=wx.EXPAND )</span>
            <span class="n">box_allcontrols</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span> <span class="n">motorZ</span><span class="p">,</span> <span class="n">proportion</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">flag</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">EXPAND</span> <span class="p">)</span>
            <span class="n">app</span><span class="o">.</span><span class="n">positioners</span><span class="p">[</span><span class="s">&#39;motorZ&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span> <span class="n">control</span><span class="o">=</span><span class="n">motorZ</span><span class="p">,</span> <span class="n">direction</span><span class="o">=</span><span class="mi">1</span> <span class="p">)</span>

    
    <span class="k">if</span> <span class="n">nummotor</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">numpiezo</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">print</span> <span class="s">&quot; you have nothing connected... quitting. &quot;</span>
        <span class="n">quit</span><span class="p">()</span>

    <span class="c">#if numpiezo &gt; 0:</span>
    <span class="c">#    box_allcontrols.Add( box_piezos )</span>
    <span class="c">#if nummotor &gt; 0:</span>
    <span class="c">#    box_allcontrols.Add( box_motors )</span>

    <span class="n">app</span><span class="o">.</span><span class="n">panel_aptcontrols</span><span class="o">.</span><span class="n">SetSizer</span><span class="p">(</span> <span class="n">box_allcontrols</span> <span class="p">)</span>

    <span class="k">if</span> <span class="n">numpiezo</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">app</span><span class="o">.</span><span class="n">make_pypiezoframe</span><span class="p">()</span>

    <span class="n">app</span><span class="o">.</span><span class="n">numpiezo</span> <span class="o">=</span> <span class="n">numpiezo</span>
    <span class="n">app</span><span class="o">.</span><span class="n">nummotor</span> <span class="o">=</span> <span class="n">nummotor</span>
    <span class="n">app</span><span class="o">.</span><span class="n">add_menu_bar</span><span class="p">()</span>
    <span class="n">app</span><span class="o">.</span><span class="n">frame_aptcontrols</span><span class="o">.</span><span class="n">Show</span><span class="p">()</span>

    <span class="n">app</span><span class="o">.</span><span class="n">wobbler</span> <span class="o">=</span> <span class="n">wobble</span><span class="p">(</span> <span class="n">app</span><span class="o">.</span><span class="n">positioners</span><span class="p">[</span><span class="s">&#39;piezoZ&#39;</span><span class="p">]</span> <span class="p">)</span>

    <span class="n">app</span><span class="o">.</span><span class="n">joystick_thread</span> <span class="o">=</span> <span class="n">JoystickThread</span><span class="p">(</span> <span class="n">app</span><span class="p">,</span> <span class="n">app</span><span class="o">.</span><span class="n">positioners</span> <span class="p">)</span>
    <span class="n">app</span><span class="o">.</span><span class="n">position_monitor_thread</span> <span class="o">=</span> <span class="n">MotorPositionMonitorThread</span><span class="p">(</span> <span class="n">app</span><span class="p">,</span> <span class="n">app</span><span class="o">.</span><span class="n">positioners</span> <span class="p">)</span>
    
    <span class="n">app</span><span class="o">.</span><span class="n">MainLoop</span><span class="p">()</span>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../index.html">pyPL 1.0 documentation</a> &raquo;</li>
          <li><a href="index.html" >Module code</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2012, Kasey J. Russell.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>